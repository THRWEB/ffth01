<style>
    .glass-card { 
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .btn-click:active { transform: scale(0.96); }
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { 
      -webkit-appearance: none; margin: 0; 
    }
</style>

<main class="max-w-md mx-auto px-4 space-y-6 py-4">

    <section class="relative overflow-hidden bg-gradient-to-br from-emerald-600 to-teal-700 rounded-[2rem] shadow-2xl p-8 text-center border border-white/20">
      <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl"></div>
      <p class="text-emerald-100/80 mb-1 font-bold text-[10px] uppercase tracking-[0.2em]">Total Balance</p>
      <h2 id="walletTotal_page" class="text-white font-black text-5xl flex items-center justify-center gap-3">
        <img src="https://i.postimg.cc/3R7QM12R/wallet-filled-money-tool.png" class="w-10 h-10 drop-shadow-lg" alt="Wallet">
        ₹0
      </h2>
    </section>

    <section class="grid grid-cols-2 gap-4">
      <div class="glass-card rounded-2xl p-5 text-center shadow-lg">
        <p class="text-gray-400 mb-1 text-[10px] font-bold uppercase tracking-wider">Deposit</p>
        <h2 id="depositAmount_page" class="text-emerald-400 font-black text-2xl">₹0</h2>
      </div>
      <div class="glass-card rounded-2xl p-5 text-center shadow-lg">
        <p class="text-gray-400 mb-1 text-[10px] font-bold uppercase tracking-wider">Winnings</p>
        <h2 id="winningsAmount_page" class="text-yellow-400 font-black text-2xl">₹0</h2>
      </div>
    </section>

    <section class="glass-card rounded-[1.5rem] p-6 space-y-4 shadow-xl">
      <h3 class="text-base font-bold text-emerald-400 flex items-center gap-2">
        <div class="p-1.5 bg-emerald-500/20 rounded-lg">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"></path></svg>
        </div>
        Add Money to Wallet
      </h3>
      <div class="relative">
        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold">₹</span>
        <input id="amountInput" type="number" min="10" placeholder="Min ₹10" class="w-full pl-8 pr-4 py-3.5 rounded-xl bg-black/40 border border-white/10 text-white font-bold focus:border-emerald-500 outline-none transition-all">
      </div>
      <button id="addBtn" class="w-full py-3.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-xl font-black text-sm uppercase tracking-widest shadow-lg btn-click">Add to Deposit</button>

      <div id="qrWrap" class="mt-5 space-y-4 hidden text-center">
        <div class="bg-white p-3 rounded-2xl inline-block shadow-inner">
          <img src="https://i.postimg.cc/T1S1SX3t/1769503340588.png" class="w-44 h-44 rounded-lg">
        </div>
        <div class="bg-emerald-500/10 p-4 rounded-xl border border-emerald-500/20 text-emerald-100 text-xs">
          <p class="font-bold text-yellow-400 text-sm mb-1 uppercase tracking-tighter">Scan to Pay</p>
          <p class="opacity-80">Amount: <span class="font-bold text-white text-sm">₹<span id="qrAmount"></span></span></p>
        </div>
        <div class="text-left">
           <label class="text-[10px] text-gray-400 font-bold ml-1 uppercase">Upload Payment Screenshot</label>
           <input type="file" id="proofFile" accept="image/*" class="w-full bg-black/40 border border-white/10 rounded-xl p-2 text-xs text-gray-400 mt-1">
        </div>
        <button id="paidBtn" disabled class="w-full py-3 bg-white/5 border border-white/10 rounded-xl font-bold opacity-30 cursor-not-allowed text-sm">SUBMIT REQUEST</button>
      </div>
    </section>

    <section class="glass-card rounded-[1.5rem] p-6 space-y-4 shadow-xl">
      <h3 class="text-base font-bold text-yellow-500 flex items-center gap-2">
        <div class="p-1.5 bg-yellow-500/20 rounded-lg">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M4 12h16"></path></svg>
        </div>
        Withdraw Winnings
      </h3>
      <input id="withdrawAmount" type="number" placeholder="Min Amount ₹15" class="w-full p-3.5 rounded-xl bg-black/40 border border-white/10 text-white font-bold focus:border-yellow-500 outline-none transition-all text-sm">
      <input id="withdrawUPI" type="text" placeholder="UPI ID (e.g. name@upi)" class="w-full p-3.5 rounded-xl bg-black/40 border border-white/10 text-white font-bold focus:border-yellow-500 outline-none transition-all text-sm">
      <button id="withdrawBtn" class="w-full py-3.5 bg-gradient-to-r from-yellow-500 to-amber-600 rounded-xl font-black text-sm uppercase tracking-widest shadow-lg btn-click">Withdraw Request</button>
    </section>

    <section onclick="router.navigate('history')" class="glass-card rounded-2xl p-4 flex items-center justify-between cursor-pointer hover:bg-white/5 transition-all btn-click group">
      <div class="flex items-center gap-4">
        <div class="bg-emerald-500/10 p-3 rounded-xl">
            <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </div>
        <div>
            <h3 class="font-bold text-sm text-gray-100">Transaction History</h3>
        </div>
      </div>
      <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"></path></svg>
    </section>

</main>

<script>
    (function() {
        const db = firebase.firestore();
        const auth = firebase.auth();

        // রিয়েলটাইম ব্যালেন্স আপডেট
        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection("users").doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        const dep = data.deposit || 0;
                        const win = data.winnings || 0;
                        document.getElementById("walletTotal_page").innerHTML = `<img src="https://i.postimg.cc/3R7QM12R/wallet-filled-money-tool.png" class="w-10 h-10 drop-shadow-lg"> ₹${dep + win}`;
                        document.getElementById("depositAmount_page").textContent = `₹${dep}`;
                        document.getElementById("winningsAmount_page").textContent = `₹${win}`;
                    }
                });
            }
        });

        // Add Money UI লজিক
        const amountInput = document.getElementById("amountInput");
        const addBtn = document.getElementById("addBtn");
        const qrWrap = document.getElementById("qrWrap");
        const qrAmount = document.getElementById("qrAmount");
        const paidBtn = document.getElementById("paidBtn");
        const proofFile = document.getElementById("proofFile");

        addBtn.onclick = () => {
            const val = parseInt(amountInput.value);
            if (val >= 10) {
                qrAmount.textContent = val;
                qrWrap.classList.remove("hidden");
                addBtn.classList.add("hidden");
            } else {
                alert("Minimum amount is ₹10");
            }
        };

        // ফাইল সিলেক্ট চেক
        proofFile.onchange = (e) => {
            if(e.target.files.length > 0) {
                paidBtn.disabled = false;
                paidBtn.classList.remove("opacity-30", "cursor-not-allowed");
                paidBtn.classList.add("bg-emerald-500", "text-white");
            }
        };

        // সাবমিট রিকোয়েস্ট লজিক
        paidBtn.onclick = async () => {
            const user = auth.currentUser;
            if (!user) return alert("Please login first");

            paidBtn.disabled = true;
            paidBtn.innerText = "UPLOADING...";

            try {
                // এখানে শুধু একটি ডামি রিকোয়েস্ট স্টোর করা হচ্ছে
                // তোমার যদি স্টোরেজ থাকে তবে ফাইল আপলোড লজিক এখানে হবে
                await db.collection("depositRequests").add({
                    uid: user.uid,
                    amount: parseInt(amountInput.value),
                    status: "pending",
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert("Request submitted successfully! It will be added after verification.");
                qrWrap.classList.add("hidden");
                addBtn.classList.remove("hidden");
                amountInput.value = "";
            } catch (err) {
                console.error(err);
                alert("Something went wrong!");
            } finally {
                paidBtn.disabled = false;
                paidBtn.innerText = "SUBMIT REQUEST";
            }
        };
    })();
</script>
