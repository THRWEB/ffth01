<style>
    #matchCard { 
      border-radius: 1.3rem; 
      border-left: 6px solid #10b981;
      background: linear-gradient(to bottom right, #1e293b, #0f172a);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    .es-value { font-weight: 800; color: #4ade80; }
</style>

<main class="max-w-md mx-auto px-3 py-4">
    <h2 id="pageTitle" class="text-xl font-bold text-emerald-400 mb-6 uppercase text-center">Matches</h2>
    <div id="matchContainer" class="space-y-4">
        <p class="text-center text-gray-500 py-10">Searching for matches...</p>
    </div>
</main>

<script>
    (async function() {
        // ১. ক্যাটাগরি আইডি নেওয়া
        const params = new URLSearchParams(window.location.search);
        const categoryId = params.get('cat') || window.currentCategory;

        if (!categoryId) {
            document.getElementById('matchContainer').innerHTML = "<p class='text-center text-red-400'>No Category Selected!</p>";
            return;
        }

        // ২. ফায়ারবেস সার্ভিস চেক (app-ui.js থেকে আসা)
        const db = firebase.firestore();
        
        const titles = {
            'soloc': 'Solo Classic', 'solocs': 'Solo Clash Squad',
            'duoc': 'Duo Classic', 'duocs': 'Duo Clash Squad',
            'squadc': 'Squad Classic', 'squadcs': 'Squad Clash Squad'
        };
        document.getElementById('pageTitle').innerText = titles[categoryId] || "Matches";

        // ৩. রিয়েল-টাইম ডাটা ফেচিং
        db.collection("allMatches").onSnapshot((snapshot) => {
            const container = document.getElementById('matchContainer');
            if(!container) return; // ইউজার অন্য পেজে চলে গেলে বন্ধ হবে

            container.innerHTML = '';
            let count = 0;

            snapshot.forEach((doc) => {
                const match = doc.data();
                if (match.category && match.category.toLowerCase() === categoryId.toLowerCase()) {
                    count++;
                    const time = window.formatMatchTime ? window.formatMatchTime(match.time) : "TBA";
                    
                    container.innerHTML += `
                        <div id="matchCard" class="px-4 pt-3 pb-4 mb-4">
                            <div class="flex items-center gap-3">
                                <img src="${match.image}" class="w-14 h-14 rounded-lg object-cover border border-emerald-500/30">
                                <div class="text-white font-bold">${match.title}</div>
                            </div>
                            <div class="mt-4 space-y-1 text-sm text-gray-400">
                                <div class="flex justify-between"><span>Entry:</span><span class="es-value">₹${match.entry}</span></div>
                                <div class="flex justify-between"><span>Prize:</span><span class="es-value">₹${match.prize}</span></div>
                                <div class="flex justify-between"><span>Time:</span><span class="es-value">${time}</span></div>
                            </div>
                            <button onclick="window.currentMatchId='${doc.id}'; router.navigate('match-details')" 
                                class="w-full mt-4 bg-emerald-500 py-2.5 rounded-xl font-bold text-white text-sm">
                                VIEW DETAILS
                            </button>
                        </div>`;
                }
            });

            if (count === 0) {
                container.innerHTML = `<p class="text-center text-gray-500 py-10">No active matches for ${titles[categoryId]}</p>`;
            }
        });
    })();
</script>
