<script type="module">
    // Firebase App এবং Firestore ইমপোর্ট করা হচ্ছে
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    // ১. আপনার ফায়ারবেস কনফিগ (এখানে আপনার নিজস্ব কীগুলো বসান)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };

    // ২. ফায়ারবেস ইনিশিয়ালাইজ করা
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    (function() {
        const container = document.getElementById('matchContainer');
        const categoryId = localStorage.getItem('currentCat');

        if (!categoryId) {
            container.innerHTML = '<p class="text-center text-red-400 mt-10">Category Missing!</p>';
            return;
        }

        console.log("Searching matches for category:", categoryId);

        // ৩. Firestore থেকে ডাটা রিদ করা
        // সরাসরি কুয়েরি লেভেলেই ফিল্টার করা ভালো (where clause ব্যবহার করে)
        const q = collection(db, "allMatches");

        onSnapshot(q, (snapshot) => {
            if (!container) return;
            container.innerHTML = '';
            let count = 0;

            snapshot.forEach((doc) => {
                const match = doc.data();
                
                // ৪. ক্যাটাগরি ম্যাচিং লজিক (সামান্য স্পেস বা কেস সেনসিটিভ সমস্যা এড়াতে)
                if (match.category && match.category.toString().trim().toLowerCase() === categoryId.trim().toLowerCase()) {
                    count++;
                    const matchDisplayTime = match.time || "TBA";
                    
                    container.innerHTML += `
                        <div id="matchCard" class="relative overflow-hidden">
                          <div class="flex items-center gap-3">
                            <img src="${match.image || 'https://i.postimg.cc/rsf7yB1M/1768308154801.jpg'}" 
                                 class="rounded-lg object-cover w-16 h-16 border-2 border-emerald-800 shadow" />
                            <div class="match-title text-gray-100 text-lg font-bold">${match.title || 'Tournament'}</div>
                          </div>
                          
                          <div class="mt-4 space-y-1.5 text-sm">
                            <div class="flex justify-between text-gray-400"><span>Entry Fee:</span><span class="es-value">₹${match.entry || 0}</span></div>
                            <div class="flex justify-between text-gray-400"><span>Prize:</span><span class="es-value">₹${match.prize || 0}</span></div>
                            <div class="flex justify-between text-gray-400"><span>Time:</span><span class="es-value">${matchDisplayTime}</span></div>
                            <div class="flex justify-between text-gray-400"><span>Map:</span><span class="es-value">${match.map || 'Bermuda'}</span></div>
                            <div class="flex justify-between text-gray-400"><span>Slots Left:</span><span class="es-value text-red-400">${match.slot || 0}</span></div>
                          </div>

                          <button onclick="localStorage.setItem('matchId', '${doc.id}'); router.navigate('match-details')" 
                            class="mt-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold py-3 rounded-xl w-full shadow-lg transition-all active:scale-95 uppercase text-sm">
                            Match Details
                          </button>
                        </div>`;
                }
            });

            if (count === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 mt-20 italic font-bold">No active matches found for ' + categoryId + '!</p>';
            }
        }, (error) => {
            console.error("Firebase Error:", error);
            container.innerHTML = '<p class="text-center text-red-400">Error loading matches!</p>';
        });
    })();
</script>
